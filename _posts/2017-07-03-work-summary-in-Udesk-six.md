---
layout: post
title: 最近工作总结(六)
date:   2017-07-03 20:16:06
categories: Work
image: /assets/images/post.jpg
---

##### 如果调用第三方接口，请别忘了超时机制
周末的时候，线上出了问题。是由于IPIP服务商的服务器出了问题，我们调的接口迟迟没有返回值。
导致我们项目中，开了很多goroutine，每个goroutine中会请求IPIP的接口分析ip地址，由于IPIP的服务器没能及时相应，
导致大量的goroutine都阻塞在了那里。所以， 不要“信任”第三方服务，调用他们服务接口的时候，应该使用超时机制。

优化方案：使用了本地化IP地址的方案，使用了这个

> https://github.com/lionsoul2014/ip2region

减少了调用IPIP的次数。这样， 内存也一下少了200+M。 Perfect!

##### 什么才是更新操作
更新操作是更新什么某个字段或某个值，则前端传那个值，然后更新这个值

如果前端把没有被更新的值也传向后端了，这也许不是合理的选择。这样，这些值之间就会互相影响。

比如，某个状态字段需要一定的权限才能更新，当更新name字段值，把所有字段值到放入参数传向后端，后端直接使用这个参数，
这样相当于更新了多个字段值。此时原本没有权限更新状态字段，但是，前端其实只是想更新name字段值，则受到影响，不会成功

##### 对多语言的翻译考虑
语言选择，从客户角度、从客服角度、从公司全局角度

三个不同的角度，范围不同、粒度不同
